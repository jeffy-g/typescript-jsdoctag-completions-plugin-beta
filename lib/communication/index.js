(()=>{"use strict";var e={10(e,o,t){Object.defineProperty(o,"__esModule",{value:!0}),o.fireProjectUpdateEvent=o.launchMessageServer=void 0;const n=t(19),r=t(22),s=t(20),{Options:c,PAYLOAD_DELIMITER:i}=r;let l,a=!1;const g=[],d="jsdoctag-completions-plugin:server",$={...c,ipv6Only:!0},u=[];const p=e=>{s.log(`${d} ERROR: ${e.message}`)};o.launchMessageServer=()=>{if(a)return void s.log(`${d} WARNING: plugin message server already launched!`);a=!0;const e=e=>`${e}/${l.maxConnections||"unlimited"}`;l=n.createServer().on("connection",t=>{g.push(t),s.log(`${d} event listener comes`),l.getConnections((o,n)=>{if(o)p(o);else{const o=`${t.remoteAddress}:${t.remotePort}`;s.log(`${d} Connection Start(${e(n)}) - ${o}`),t.on("end",()=>{!function(e){const o=g.indexOf(e);-1!==o&&g.splice(o,1)}(t),
l.getConnections((t,n)=>{t?p(t):s.log(`${d} Connection End(${e(n)}) - ${o}`)})})}}),u.length&&(s.log(`${d} - on connection (messageQueue=${JSON.stringify(u,null,2)}) call fireProjectUpdateEvent::`+u.length),(0,o.fireProjectUpdateEvent)(u.shift()))}).on("error",e=>{s.log(`${d} [${JSON.stringify(e)}]`)}).on("close",()=>{s.log(`${d} Server Closed`)}).on("listening",()=>{const e=l.address();s.log(`${d} Listening Start on Server - ${e.address}:${e.port}`)}).listen($)};const v=e=>{const{projectName:o}=e;s.log(`${d}::notify (lisner=${g.length}) - ${o} update`),g.forEach(o=>{s.log(`${d}::notify send update event to - ${o.remoteAddress}:${o.remotePort}`);const t=o.write(JSON.stringify(e)+i);t||s.log(`${d}::notify flashed=${t}, bytesWritten=${o.bytesWritten}`)})};o.fireProjectUpdateEvent=e=>{
g.length?(u.length&&(u.forEach(v),u.length=0),v(e)):u.push(e)}},11(e,o,t){const n=t(19),r=t(22),{Options:s,PAYLOAD_DELIMITER:c}=r,i=`${s.host}:${s.port}`,l={log:()=>{}},a=()=>{const e=new Date;return`[${e.toLocaleTimeString()}.${(e.getMilliseconds()+"").padStart(3,"0")} jsdoctag-completions-plugin:client]`},g=(()=>{let e=1500;return()=>0|(e*=1.35)})();e.exports=(e,o=l)=>{let t,r,d=!1,$=0;const u=()=>{if(d||++$>=20)return o.log(`${a()} ${d?"RECONNECT SUCCEED!":"RECONNECTION FAILED"}`),void clearTimeout(r);o.log(`${a()} Trying to reconnect`),v(),r=setTimeout(u,g())},p=((e,o=l,t="")=>n=>{t+=n.toString();const r=/[^\x00]+/g;let s;for(;s=r.exec(t);){let t=s[0];try{const n=JSON.parse(t);o.log(`${a()} event from ${n.projectName}, closed: ${n.closed}`),e(n)}catch(e){
o.log(`${a()} on data ERROR, chunk: ${t}`),console.log(e)}}const i=t.lastIndexOf(c);t=i!==t.length-1?t.slice(i+1):""})(e,o),v=()=>{if(t)t.connect(s);else{t=n.connect(s).on("connect",()=>{d=!0,console.log(`${a()} Connection - ${i}`)}).on("data",p).on("timeout",()=>{o.log(`${a()} socket timeout`)}).on("error",e=>{o.log(`${a()} Connection Failed - ${i}`),console.error(e.message),"ECONNREFUSED"!==e.code||r||(r=setTimeout(u,g()))}).on("end",()=>{o.log(`${a()} Connection End - ${i}`)}).on("close",e=>{o.log(`${a()} Connection Closed, hadError=${e}`)})}};setTimeout(v,1500)}},19(e){e.exports=require("net")},20(e){e.exports=require("../logger")},22(e,o){Object.defineProperty(o,"__esModule",{value:!0}),o.Options=o.PAYLOAD_DELIMITER=void 0,o.PAYLOAD_DELIMITER="\0",o.Options={host:"127.0.0.1",
port:51234}}},o={};function t(n){var r=o[n];if(void 0!==r)return r.exports;var s=o[n]={exports:{}};return e[n](s,s.exports,t),s.exports}var n={};(()=>{var e=n;Object.defineProperty(e,"__esModule",{value:!0}),e.subscribeProjectEvent=e.fireProjectUpdateEvent=e.launchMessageServer=void 0;const o=t(10),r=t(11);e.launchMessageServer=o.launchMessageServer,e.fireProjectUpdateEvent=o.fireProjectUpdateEvent,e.subscribeProjectEvent=r})(),module.exports=n})();