(()=>{"use strict";var e={452:(e,o,t)=>{const n=t(278),r=t(337),s=`${r.Options.host}:${r.Options.port}`,i={log:()=>{}},c=()=>{const e=new Date;return`[${e.toLocaleTimeString()}.${(e.getMilliseconds()+"").padStart(3,"0")} jsdoctag-completions-plugin:client]`},l=(()=>{let e=1500;return()=>e*=1.5})();e.exports=(e,o=i)=>{let t,a,g=!1,d=0;const p=()=>{if(g||++d>=20)return o.log(`${c()} ${g?"RECONNECT SUCCEED!":"RECONNECTION FAILED"}`),void clearTimeout(a);o.log(`${c()} Trying to reconnect`),$(),a=setTimeout(p,l())},$=()=>{t?t.connect(r.Options):t=n.connect(r.Options).on("connect",(()=>{g=!0,console.log(`${c()} Connection - ${s}`)})).on("data",(t=>{try{const n=JSON.parse(t.toString());o.log(`${c()} event from ${n.projectName}`),e(n)}catch(e){console.log(e.toString())}})).on("timeout",(()=>{
o.log(`${c()} socket timeout`)})).on("error",(e=>{o.log(`${c()} Connection Failed - ${s}`),console.error(e.message),"ECONNREFUSED"!==e.code||a||(a=setTimeout(p,l()))})).on("end",(()=>{o.log(`${c()} Connection End - ${s}`)})).on("close",(e=>{o.log(`${c()} Connection Closed, hadError=${e}`)}))};setTimeout($,1500)}},337:(e,o)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.Options=void 0,o.Options={host:"127.0.0.1",port:51234}},320:(e,o,t)=>{Object.defineProperty(o,"__esModule",{value:!0}),o.fireProjectUpdateEvent=o.launchMessageServer=void 0;const n=t(278),r=t(337),s=t(543);let i,c=!1;const l=[],a="jsdoctag-completions-plugin:server",g={...r.Options,ipv6Only:!0},d=[];const p=e=>{s.log(`${a} ERROR: ${e.message}`)};o.launchMessageServer=()=>{
if(c)return void s.log(`${a} WARNING: plugin message server already launched!`);c=!0;const e=e=>`${e}/${i.maxConnections||"unlimited"}`;i=n.createServer().on("connection",(t=>{l.push(t),s.log(`${a} event listener comes`),i.getConnections(((o,n)=>{if(o)p(o);else{const o=`${t.remoteAddress}:${t.remotePort}`;s.log(`${a} Connection Start(${e(n)}) - ${o}`),t.on("end",(()=>{!function(e){const o=l.indexOf(e);-1!==o&&l.splice(o,1)}(t),i.getConnections(((t,n)=>{t?p(t):s.log(`${a} Connection End(${e(n)}) - ${o}`)}))}))}})),d.length&&(0,o.fireProjectUpdateEvent)(d.pop())})).on("error",(e=>{s.log(`${a} [${JSON.stringify(e)}]`)})).on("close",(()=>{s.log(`${a} Server Closed`)})).on("listening",(()=>{const e=i.address();s.log(`${a} Listening Start on Server - ${e.address}:${e.port}`)})).listen(g)}
;const $=e=>{const{projectName:o}=e;s.log(`${a} (lisner=${l.length}) - ${o} update`),l.forEach((o=>{s.log(`${a} send update event to - ${o.remoteAddress}:${o.remotePort}`),o.write(JSON.stringify(e))}))};o.fireProjectUpdateEvent=e=>{l.length?(d.length&&(d.forEach($),d.length=0),$(e)):d.push(e)}},543:e=>{e.exports=require("../logger")},278:e=>{e.exports=require("net")}},o={};function t(n){var r=o[n];if(void 0!==r)return r.exports;var s=o[n]={exports:{}};return e[n](s,s.exports,t),s.exports}var n={};(()=>{var e=n;Object.defineProperty(e,"__esModule",{value:!0}),e.subscribeProjectEvent=e.fireProjectUpdateEvent=e.launchMessageServer=void 0;const o=t(320),r=t(452);e.launchMessageServer=o.launchMessageServer,e.fireProjectUpdateEvent=o.fireProjectUpdateEvent,e.subscribeProjectEvent=r})(),
module.exports=n})();