(()=>{"use strict";var e={10(e,t,o){Object.defineProperty(t,"__esModule",{value:!0}),t.fireProjectUpdateEvent=t.launchMessageServer=void 0;const n=o(19),r=o(23),s=o(20),{Options:c,PAYLOAD_DELIMITER:i}=r;let l,a=!1;const g=[],d="jsdoctag-completions-plugin:server",$={...c,ipv6Only:!0},u=[];const p=e=>{s.log(`${d} ERROR: ${e.message}`)};t.launchMessageServer=()=>{if(a)return void s.log(`${d} WARNING: plugin message server already launched!`);a=!0;const e=e=>`${e}/${l.maxConnections||"unlimited"}`;l=n.createServer().on("connection",o=>{g.push(o),s.log(`${d} event listener comes`),l.getConnections((t,n)=>{if(t)p(t);else{const t=`${o.remoteAddress}:${o.remotePort}`;s.log(`${d} Connection Start(${e(n)}) - ${t}`),o.on("end",()=>{!function(e){const t=g.indexOf(e);-1!==t&&g.splice(t,1)}(o),
l.getConnections((o,n)=>{o?p(o):s.log(`${d} Connection End(${e(n)}) - ${t}`)})})}}),u.length&&(s.log(`${d} - on connection (messageQueue=${JSON.stringify(u,null,2)}) call fireProjectUpdateEvent::`+u.length),(0,t.fireProjectUpdateEvent)(u.shift()))}).on("error",e=>{s.log(`${d} [${JSON.stringify(e)}]`)}).on("close",()=>{s.log(`${d} Server Closed`)}).on("listening",()=>{const e=l.address();s.log(`${d} Listening Start on Server - ${e.address}:${e.port}`)}).listen($)};const v=e=>{const{projectName:t}=e;s.log(`${d}::notify (lisner=${g.length}) - ${t} update`),g.forEach(t=>{s.log(`${d}::notify send update event to - ${t.remoteAddress}:${t.remotePort}`);const o=t.write(JSON.stringify(e)+i);o||s.log(`${d}::notify flashed=${o}, bytesWritten=${t.bytesWritten}`)})};t.fireProjectUpdateEvent=e=>{
g.length?(u.length&&(u.forEach(v),u.length=0),v(e)):u.length<10&&u.push(e)}},11(e,t,o){const n=o(19),r=o(23),{Options:s,PAYLOAD_DELIMITER:c}=r,i=`${s.host}:${s.port}`,l={log:()=>{}},a=()=>{const e=new Date;return`[${e.toLocaleTimeString()}.${(e.getMilliseconds()+"").padStart(3,"0")} jsdoctag-completions-plugin:client]`},g=(()=>{let e=1500;return()=>0|(e*=1.35)})();e.exports=(e,t=l)=>{let o,r,d=!1,$=0;const u=()=>{if(d||++$>=20)return t.log(`${a()} ${d?"RECONNECT SUCCEED!":"RECONNECTION FAILED"}`),void clearTimeout(r);t.log(`${a()} Trying to reconnect`),v(),r=setTimeout(u,g())},p=((e,t=l,o="")=>n=>{o+=n.toString();const r=/[^\x00]+?(?=\x00)/g;let s;for(;s=r.exec(o);){let o=s[0];try{const n=JSON.parse(o);t.log(`${a()} event from ${n.projectName}, closed: ${n.closed}`),e(n)}catch(e){
t.log(`${a()} on data ERROR, chunk: ${o}`),console.log(e)}}const i=o.lastIndexOf(c);o=i!==o.length-1?o.slice(i+1):""})(e,t),v=()=>{o?o.connect(s):o=n.connect(s).on("connect",()=>{d=!0,console.log(`${a()} Connection - ${i}`)}).on("data",p).on("timeout",()=>{t.log(`${a()} socket timeout`)}).on("error",e=>{t.log(`${a()} Connection Failed - ${i}`),console.error(e.message),"ECONNREFUSED"!==e.code||r||(r=setTimeout(u,g()))}).on("end",()=>{t.log(`${a()} Connection End - ${i}`)}).on("close",e=>{t.log(`${a()} Connection Closed, hadError=${e}`)})};setTimeout(v,1500)}},19(e){e.exports=require("net")},20(e){e.exports=require("../logger")},23(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Options=t.PAYLOAD_DELIMITER=void 0,t.PAYLOAD_DELIMITER="\0",t.Options={host:"127.0.0.1",port:51234}}},t={}
;function o(n){var r=t[n];if(void 0!==r)return r.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,o),s.exports}var n={};(()=>{var e=n;Object.defineProperty(e,"__esModule",{value:!0}),e.subscribeProjectEvent=e.fireProjectUpdateEvent=e.launchMessageServer=void 0;const t=o(10),r=o(11);e.launchMessageServer=t.launchMessageServer,e.fireProjectUpdateEvent=t.fireProjectUpdateEvent,e.subscribeProjectEvent=r})(),module.exports=n})();